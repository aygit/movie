pipeline {
   agent any



  stages {
   stage('checkout') {
     steps {
       checkout scm
     }

  }


  // do jest testing
    stage('codecoverage') {
      steps {
       sh 'npm install'
//       sh 'npm test -- --ci --testResultsProcessor="jest-junit"'
       sh 'npm install jest jest-junit jest-junit-reporter'
       sh 'yarn add --dev jest-styled-components'
       sh 'npx jest test  --coverage'
       
       sh 'npm test -- --ci --testResultsProcessor="jest-junit"'
      }
     
     post {
        always { 
       publishHTML (target: [
      allowMissing: false,
      alwaysLinkToLastBuild: true,
      keepAll: true,
      reportDir: 'coverage/lcov-report',
      reportFiles: 'index.html',
      reportName: "code-coverage"
    ])

    }
  }
 }

    
    stage('unit test') {
      steps {
         sh 'npm test -- --ci --testResultsProcessor="jest-junit"'
        }
     //publish coverage report
      post {
       always  {
         junit 'reports/*.xml'
    }
  }
 }
 // testing test
    stage('pubtest') {
     steps {
    junit 'reports/*.xml'


  }
 }


 //publish to npm repo
// stage('publish') {
//    steps {
 //    sh 'source ~/.profile'
//     sh 'source ~/.bash_profile'
//     sh 'npm publish'
//    }

// }

}

//post {
//        always {
//            junit testResults: 'reports/*.xml'
//        }
//    }




 }
